# Серверна автентифікація

## Зміни в архітектурі

Автентифікація тепер виконується повністю на сервері (SSR) замість клієнтського JavaScript.

## Login (Вхід)

### Файл: `src/pages/index.astro`

**Як працює:**
1. Користувач заповнює форму (username, password, TOTP код)
2. Форма відправляється як HTML POST запит на ту ж саму сторінку
3. Astro обробляє POST запит в server-side коді (frontmatter)
4. Викликається зовнішній Backend API для автентифікації
5. При успіху встановлюються cookies і робиться редірект на `/notifications`
6. При помилці сторінка перезавантажується з повідомленням про помилку

**Переваги:**
- Швидше (немає проблем з timeout)
- Безпечніше (credentials не проходять через клієнтський JS)
- Простіше (менше коду)
- Працює навіть без JavaScript

## Logout (Вихід)

### Файл: `src/pages/logout.astro`

**Як працює:**
1. Користувач натискає кнопку "Вийти" (тепер це посилання `<a href="/logout">`)
2. Браузер переходить на `/logout`
3. Astro виконує server-side код:
   - Викликає Backend API для logout (якщо є токен)
   - Видаляє cookies
   - Робить редірект на `/` (сторінку входу)

**Переваги:**
- Миттєвий logout (немає затримок з fetch)
- Надійний (завжди спрацьовує)
- Простий (одне посилання замість складного JavaScript)

## Компоненти

### `src/components/Header.astro`
- Кнопка logout змінена з `<button>` на `<a href="/logout">`
- Видалено `id="logoutButton"` (більше не потрібен для JavaScript)

### `src/pages/notifications.astro`
- Видалено весь JavaScript код для logout
- Залишено тільки FCM та інші функції

## API Endpoints (застарілі)

Ці файли залишені для сумісності, але більше не використовуються:
- `src/pages/api/auth/login.ts` - замінено на server-side обробку в index.astro
- `src/pages/api/auth/logout.ts` - замінено на logout.astro

Можна видалити їх або залишити для можливого використання в майбутньому.

## Тестування

1. **Login**: Перейдіть на `/`, введіть credentials, натисніть "Увійти"
2. **Logout**: На сторінці notifications натисніть іконку виходу
3. **Перевірте логи**: В терміналі dev server побачите всі кроки автентифікації

## Логування

Всі операції логуються на сервері:
- `=== Server-side login attempt ===`
- `=== Logout page accessed ===`
- Час відповіді Backend API
- Статуси відповідей
